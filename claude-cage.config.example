claude_cage {

    -- Project name (optional - derived from directory structure if not specified)
    -- The script searches for claude-cage.config up the directory tree.
    -- Project name is derived from the first directory component after the config root.
    -- Example: config at ~/Projects/claude-cage.config, running from ~/Projects/myapp/src
    --          -> project = "myapp" (derived automatically)
    --
    -- You can override this by specifying it here or on command line.
    -- Command line takes precedence: sudo claude-cage backend
    -- project = "myproject",

    -- Project-specific config files (optional)
    -- Create projectname.claude-cage.config for project-specific overrides
    -- Example: backend.claude-cage.config, frontend.claude-cage.config
    -- These are loaded when you run from that project's subdirectory

    -- Base user name (default: "claude")
    -- user = "claude",

    -- User isolation mode (default: "single")
    -- Options: "single" or "per-project"
    --
    -- Single-user mode (default): All projects share one user
    --   - Username: "claude" (just the base username)
    --   - User home: /home/claude/ (standard location)
    --   - Network rules: Shared across projects, persist until last instance exits
    --   - Claude Code authentication: Login once, works for all projects
    --
    -- Per-project mode: Each project gets its own user
    --   - Username: "claude-myproject" (user + "-" + userAppend or project)
    --   - User home: /home/.claude-cage/claude-myproject/
    --   - Network rules: Project-specific, cleaned up when project exits
    --   - Claude Code authentication: Requires login for each new project user
    --
    -- userMode = "single",

    -- Optional: Custom suffix for per-project mode (overrides using project name)
    -- Only applies when userMode = "per-project"
    -- userAppend = "myproject",

    -- ============================================================================
    -- MODE SELECTION: Choose sync mode (default) or direct mount mode
    -- ============================================================================

    -- Direct mount mode (default: false)
    -- false: Sync mode - creates sync directory with unison, provides file exclusion
    -- "workspace": Direct mount - mounts entire source, Claude can access sibling projects
    -- "project": Direct mount - mounts only the specified project, no sibling access
    --
    -- In both direct mount modes:
    --   - Command-line argument specifies which project to work in (required)
    --   - No file exclusion - all files in mounted directory are accessible
    --   - Only use with directories containing files safe for Claude to access
    --
    -- Workspace mode: Mount point name derived from source directory basename
    --   Example: cd ~/Projects/public && sudo claude-cage my-project
    --   Mounts ~/Projects/public/ to /home/claude/caged/public/
    --   Claude starts in /home/claude/caged/public/my-project/ but can cd to siblings
    --
    -- Project mode: Mount point name is the project subdirectory name
    --   Example: cd ~/Projects/public && sudo claude-cage my-project
    --   Mounts ~/Projects/public/my-project/ to /home/claude/caged/my-project/
    --   Claude starts at mount root, cannot access sibling projects
    --
    -- directMount = false,

    -- ============================================================================
    -- SYNC MODE SETTINGS (ignored in direct mount mode)
    -- ============================================================================

    -- Source directory (optional - defaults to config root directory)
    -- The script uses the directory containing claude-cage.config as the source.
    -- You can override this to sync only a subdirectory.
    --
    -- IMPORTANT: In sync mode, you cannot run from the config root directory.
    -- You must cd into a subdirectory first to avoid .caged recursion issues.
    -- source = "my-directory",

    -- Sync directory for unison to sync source with (sync mode only)
    -- Default: .caged/project-name/sync
    -- Structure: .caged/project-name/sync and .caged/project-name/excludes-cache
    -- Add ".caged" to .gitignore if running from within a git repository
    -- sync = ".caged/myproject/sync",

    -- Mount configuration
    -- mountBase: Base directory under user home (default: "caged")
    --   Set to "" to mount directly under user home
    --   Example: mountBase = "caged" → /home/claude/caged/<project>/
    --   Example: mountBase = "" → /home/claude/<project>/
    -- mountBase = "caged",

    -- mounted: Final directory name (default: project name)
    --   This is the actual working directory where Claude starts
    --   Example: mounted = "my-app" → /home/claude/caged/my-app/
    -- mounted = "",  -- Defaults to project name

    -- Show ASCII art banner (default: true)
    -- Set to false to disable banner, or use --no-banner CLI flag
    -- showBanner = false,

    -- ============================================================================
    -- FILE EXCLUSION (SYNC MODE ONLY - ignored in direct mount mode)
    -- ============================================================================

    -- PROJECT-SPECIFIC excludes (add to user/system defaults)
    -- These are merged with excludes from system and user configs
    -- All exclude options are grouped under the 'exclude' object:
    --
    -- exclude = {
    --     path = { "config/production.yml" },  -- exact paths relative to source root
    --     name = { ".env", "node_modules" },   -- files/folders by name anywhere in tree
    --     belowPath = { ".git" },              -- path + everything below it (root only)
    --     regex = { ".*\\.log$" }              -- regex patterns for complex matching
    -- },
    --
    -- path: Exact paths from source root
    -- name: Matches anywhere in tree (use for .env, node_modules, target, etc.)
    -- belowPath: Root path + all contents (use for .git)
    -- regex: Complex patterns (escape backslashes in Lua strings)

    -- ============================================================================
    -- CAGE-LOCAL FILES (SYNC MODE ONLY - ignored in direct mount mode)
    -- ============================================================================

    -- Prevents new files created in cage from appearing in source.
    --
    -- Unlike 'exclude' (which never syncs in either direction), cageLocal only
    -- blocks creation of NEW files on the source side:
    --   - New files created in cage → don't appear in source
    --   - Existing files in both → sync normally (updates go both ways)
    --
    -- Example: shell/tool config files Claude creates (.bashrc, .gitconfig, etc.)
    --
    -- cageLocal = {
    --     name = { ".bashrc", ".profile", ".zshrc", ".gitconfig", ".mcp.json" }
    -- },

    -- ============================================================================
    -- HOME CONFIG SYNC (optional - sync config files to cage user's home)
    -- ============================================================================

    -- Sync config files or directories from your home directory to the cage
    -- user's home. Paths are relative to home directory. If only source is
    -- specified, destination is the same path under the cage user's home.
    --
    -- Entries are processed in order - useful for copying a directory first,
    -- then overwriting specific files within it.
    --
    -- WARNING: Be careful not to sync files containing secrets (API keys,
    -- tokens, credentials). Review each file before adding it here.
    --
    -- homeConfigSync = {
    --     ".gitconfig",                                                    -- same path
    --     ".mcp.json",                                                     -- same path
    --     ".claude",                                                       -- entire directory
    --     { ".config/claude-cage/claude-settings.json", ".claude/settings.json" }
    -- },

    -- ============================================================================
    -- NETWORK RESTRICTIONS (optional - defense in depth)
    -- ============================================================================

    -- Network mode (default: "disabled")
    -- Options: "disabled", "allowlist", "blocklist"
    -- networkMode = "disabled",

    -- NOTE: In single-user mode (default), network rules are shared across all
    -- projects and persist until the last instance exits. In per-project mode,
    -- each project gets its own network rules.

    -- Allowlist mode: Only allow specific connections (everything else blocked)
    -- allow = {
    --     domains = { "github.com:443", "registry.npmjs.org:443" },
    --     ips = { "127.0.0.1:5432" },
    --     networks = { "192.168.1.0/24" }
    -- },

    -- Blocklist mode: Block specific connections (everything else allowed)
    -- block = {
    --     domains = { "internal.company.com" },
    --     ips = { "169.254.169.254" },
    --     networks = { "127.0.0.1", "192.168.0.0/16", "10.0.0.0/8" }
    -- },

    -- Blocklist exceptions: Allow specific connections even when blocked
    -- (Can use allow.domains/ips/networks in blocklist mode for exceptions)
    -- allow = { ips = { "127.0.0.1:5432" } },  -- Allow PostgreSQL even if localhost blocked
}
