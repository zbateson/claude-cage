-- Example system-wide config for claude-cage
-- Place at: /etc/claude-cage/config
--
-- This file provides system-wide defaults for all users.
-- Users can override these in ~/.config/claude-cage/config
-- Projects can override these in ./claude-cage.config (required)

claude_cage {
    -- Project name is required in local config (./claude-cage.config)
    -- Not typically set in system-wide config
    -- project = "myproject",

    -- Default user to run claude as (default: "claude")
    -- Users are automatically deleted on exit (unless they existed before)
    -- user = "claude",

    -- User isolation mode (default: "single")
    -- Options: "single" or "per-project"
    --
    -- Single-user mode (RECOMMENDED): All projects share one user (e.g., "claude")
    --   - User home: /home/claude/ (standard location)
    --   - Network rules: Shared across all projects
    --   - Claude Code authentication: Login once, works for all projects
    --
    -- Per-project mode: Each project gets its own user (e.g., "claude-myproject")
    --   - User home: /home/.claude-cage/claude-myproject/
    --   - Network rules: Project-specific
    --   - Claude Code authentication: Requires login for each new project user
    --
    -- userMode = "single",

    -- Show ASCII art banner (default: true)
    -- showBanner = false,

    -- ============================================================================
    -- MODE SELECTION (typically set per-project, not system-wide)
    -- ============================================================================

    -- Direct mount mode (default: false)
    -- false: Sync mode - creates sync directory with unison, provides file exclusion
    -- true: Direct mount mode - mounts source directly, no sync, no duplication
    --       WARNING: No file exclusion in direct mount mode
    -- Most users leave this unset here and configure per-project
    -- directMount = false,

    -- ============================================================================
    -- SYNC MODE SETTINGS (ignored in direct mount mode)
    -- ============================================================================

    -- Default prefix for sync directories (default: ".caged-")
    -- Creates hidden sync directories to keep workspace clean
    syncPrepend = ".caged-",

    -- Mount configuration
    -- mountBase: Base directory under user home (default: "caged")
    --   Projects mount at /home/<user>/<mountBase>/<project>/
    --   Set to "" to mount directly: /home/<user>/<project>/
    -- mountBase = "caged",

    -- mounted: Override the final directory name (default: project name)
    -- mounted = "",

    -- ============================================================================
    -- FILE EXCLUSION (SYNC MODE ONLY - ignored in direct mount mode)
    -- ============================================================================

    -- Common excludes that apply to all projects
    -- WARNING: These only work in sync mode. Direct mount mode exposes all files.

    -- Use excludePath for specific directories at the root
    excludePath = {
        ".git",
        "target"
    },

    -- Use excludeName for files/folders by name anywhere
    excludeName = {
        ".DS_Store",
        "*.swp",
        "*~"
    },

    -- Use belowPath to exclude entire directory trees
    belowPath = {
        "node_modules"
    },

    -- ============================================================================
    -- NETWORK RESTRICTIONS (optional - defense in depth)
    -- ============================================================================

    -- Default to disabled; users/projects can override
    -- NOTE: In single-user mode (default), network rules are shared across all
    -- projects and persist until the last instance exits. In per-project mode,
    -- each project gets its own network rules.
    networkMode = "disabled",

    -- Allowlist mode example: Only allow Claude's required domains
    -- Claude Code requires these domains to function:
    allowedDomains = { "api.anthropic.com", "claude.ai", "statsig.anthropic.com", "sentry.io" },

    -- Block private networks by default (uncomment networkMode to enable)
    -- NOTE: If you need to allow specific services on blocked networks,
    -- use allowedIPs or allowedNetworks exceptions (see below)
    -- networkMode = "blocklist",
    blockNetworks = {
        "127.0.0.1",             -- Localhost
        "192.168.0.0/16",        -- Private networks
        "10.0.0.0/8"             -- Corporate network
    },

    -- Additional blocklist options
    -- blockDomains = {
    --     "internal.company.com",  -- Block internal corporate domain
    --     "malicious-site.com"     -- Block known malicious domains
    -- },
    -- blockIPs = {
    --     "169.254.169.254",       -- Cloud metadata services (AWS, Azure, GCP)
    --     "192.168.1.100:5432"     -- Block PostgreSQL on specific server
    -- },

    -- Blocklist exceptions: allow specific connections even when blocked
    -- Example: Block all private network except specific development services
    -- allowedIPs = { "127.0.0.1:5432", "192.168.1.50:3000" },  -- Allow PostgreSQL, dev server
}
